## Exercise 6.1

### Question:

만약 ![equation](https://latex.codecogs.com/svg.latex?V) 가 에피소드 동안 변한다면, 식 6.6은 오직 근사적으로만 성립한다. 그렇다면 등식의 양변 사이의 차이는 얼마인가? TD 오차(식 6.5)와 TD 갱신(식 6.2)에서 시각 ![equation](https://latex.codecogs.com/svg.latex?t) 에 사용되는 상태 가치의 배열을 ![equation](https://latex.codecogs.com/svg.latex?V_t) 라고 하자. TD 오차의 합과 몬테카를로 오차가 같아지게 하려면 TD 오차의 합에 추가로 얼마가 더해져야 하는지를 결정하기 위해 위의 유도 과정을 다시 수행하라.

### Answer:

시각 ![equation](https://latex.codecogs.com/svg.latex?t) 에 사용되는 상태 가치의 배열을 ![equation](https://latex.codecogs.com/svg.latex?V_t) 라고 할 때, TD 갱신과 TD 오차는 아래와 같이 표현된다.

<img src="https://latex.codecogs.com/svg.latex?\begin{align*}&space;V_{t&plus;1}(S_t)&space;&=&space;V_t(S_t)&space;&plus;&space;\alpha&space;[R_{t&plus;1}&space;&plus;&space;\gamma&space;V_t(S_{t&plus;1})&space;-&space;V_t(S_t)]&space;\\&space;\delta_t&space;&\doteq&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;V_t(S_{t&plus;1})&space;-&space;V_t(S_t)&space;\end{align*}" title="\begin{align*} V_{t+1}(S_t) &= V_t(S_t) + \alpha [R_{t+1} + \gamma V_t(S_{t+1}) - V_t(S_t)] \\ \delta_t &\doteq R_{t+1} + \gamma V_t(S_{t+1}) - V_t(S_t) \end{align*}" />

그리고 ![equation](https://latex.codecogs.com/svg.latex?\inline&space;V_{t+1}(S_t)-V_t(S_t)) 를 ![equation](https://latex.codecogs.com/svg.latex?\inline&space;u_t) 라고 하자.

<img src="https://latex.codecogs.com/svg.latex?\begin{align*}&space;V_{t&plus;1}(S_t)&space;-&space;V_t(S_t)&space;&=&space;\alpha&space;[R_{t&plus;1}&space;&plus;&space;\gamma&space;V_t(S_{t&plus;1})&space;-&space;V_t(S_t)]&space;\\&space;&=&space;u_t&space;\end{align*}" title="\begin{align*} V_{t+1}(S_t) - V_t(S_t) &= \alpha [R_{t+1} + \gamma V_t(S_{t+1}) - V_t(S_t)] \\ &= u_t \end{align*}" />

몬테카를로 오차를 TD 오차의 합으로 표현하면,

<img src="https://latex.codecogs.com/svg.latex?\begin{align*}&space;G_t&space;-&space;V_t(S_t)&space;&=&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;G_{t&plus;1}&space;-&space;V_t(S_t)&space;&plus;&space;\gamma&space;V_t(S_{t&plus;1})&space;-&space;\gamma&space;V_t(S_{t&plus;1})&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma(G_{t&plus;1}&space;-&space;V_t(S_{t&plus;1}))&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma(G_{t&plus;1}&space;-&space;V_{t&plus;1}(S_{t&plus;1}))&space;&plus;&space;\gamma(V_{t&plus;1}(S_{t&plus;1})&space;-&space;V_t(S_{t&plus;1}))&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma(G_{t&plus;1}&space;-&space;V_{t&plus;1}(S_{t&plus;1}))&space;&plus;&space;\gamma&space;u_{t&plus;1}&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma[\delta_{t&plus;1}&space;&plus;&space;\gamma(G_{t&plus;2}&space;-&space;V_{t&plus;2}(S_{t&plus;2}))&space;&plus;&space;\gamma&space;u_{t&plus;2}]&space;&plus;&space;\gamma&space;u_{t&plus;1}&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma\delta_{t&plus;1}&space;&plus;&space;\gamma^2(G_{t&plus;2}&space;-&space;V_{t&plus;2}(S_{t&plus;2}))&space;&plus;&space;\gamma&space;u_{t&plus;1}&space;&plus;&space;\gamma^2&space;u_{t&plus;2}&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma&space;\delta_{t&plus;1}&space;&plus;&space;\cdots&space;&plus;&space;\gamma^{T-t}(G_T&space;-&space;V_T(S_T))&space;&plus;&space;\gamma&space;u_{t&plus;1}&space;&plus;&space;\cdots&space;&plus;&space;\gamma^{T-t}&space;u_T&space;\\&space;&=&space;\delta_t&space;&plus;&space;\gamma&space;\delta_{t&plus;1}&space;&plus;&space;\cdots&space;&plus;&space;\gamma^{T-t}(0&space;-&space;0)&space;&plus;&space;\gamma&space;u_{t&plus;1}&space;&plus;&space;\cdots&space;&plus;&space;\gamma^{T-t}&space;u_T&space;\\&space;&=&space;\sum_{k=t}^{T-1}\gamma^{k-t}\delta_k&space;&plus;&space;\sum_{k=t&plus;1}^{T}\gamma^{k-t}u_{k}&space;\end{align*}" title="\begin{align*} G_t - V_t(S_t) &= R_{t+1} + \gamma G_{t+1} - V_t(S_t) + \gamma V_t(S_{t+1}) - \gamma V_t(S_{t+1}) \\ &= \delta_t + \gamma(G_{t+1} - V_t(S_{t+1})) \\ &= \delta_t + \gamma(G_{t+1} - V_{t+1}(S_{t+1})) + \gamma(V_{t+1}(S_{t+1}) - V_t(S_{t+1})) \\ &= \delta_t + \gamma(G_{t+1} - V_{t+1}(S_{t+1})) + \gamma u_{t+1} \\ &= \delta_t + \gamma[\delta_{t+1} + \gamma(G_{t+2} - V_{t+2}(S_{t+2})) + \gamma u_{t+2}] + \gamma u_{t+1} \\ &= \delta_t + \gamma\delta_{t+1} + \gamma^2(G_{t+2} - V_{t+2}(S_{t+2})) + \gamma u_{t+1} + \gamma^2 u_{t+2} \\ &= \delta_t + \gamma \delta_{t+1} + \cdots + \gamma^{T-t}(G_T - V_T(S_T)) + \gamma u_{t+1} + \cdots + \gamma^{T-t} u_T \\ &= \delta_t + \gamma \delta_{t+1} + \cdots + \gamma^{T-t}(0 - 0) + \gamma u_{t+1} + \cdots + \gamma^{T-t} u_T \\ &= \sum_{k=t}^{T-1}\gamma^{k-t}\delta_k + \sum_{k=t+1}^{T}\gamma^{k-t}u_{k} \end{align*}" />

와 같이 표현되므로, TD 오차의 합에 추가로 ![equation](https://latex.codecogs.com/svg.latex?\inline&space;\sum_{k=t&plus;1}^{T}\gamma^{k-t}u_{k}) 가 더해져야 한다.
