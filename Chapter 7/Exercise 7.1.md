## Exercise 7.1

### Question:

6장에서 가치의 추정값이 단계가 바뀔 때에 변하지 않는다면 모네카를로 오차가 TD 오차(식 6.6)의 합으로 표현될 수 있음을 알았다. 식 7.2에 사용된 ![equation](https://latex.codecogs.com/svg.latex?n) 단계 오차 역시 (여기서도 가치 추정값이 변하지 않는다면) 초기 결과를 일반화하는 TD 오차의 합으로 표현될 수 있음을 보여라.

### Answer:

TD 오차와 식 7.2에 사용된 ![equation](https://latex.codecogs.com/svg.latex?n) 단계 오차는 아래와 같다.
<img src="https://latex.codecogs.com/svg.latex?\inline&space;\begin{align*}&space;\delta_t&space;&\doteq&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;V_t(S_{t&plus;1})&space;-&space;V_t(S_t)&space;\\&space;G_{t:t&plus;n}&space;-&space;V_{t&plus;n-1}(S_t)&space;&=&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;R_{t&plus;2}&space;&plus;&space;\cdots&space;&plus;&space;\gamma^{n-1}R_{t&plus;n}&space;&plus;&space;\gamma^nV_{t&plus;n-1}(S_{t&plus;n})&space;-&space;V_{t&plus;n-1}(S_t)&space;\end{align*}" title="\begin{align*} \delta_t &\doteq R_{t+1} + \gamma V_t(S_{t+1}) - V_t(S_t) \\ G_{t:t+n} - V_{t+n-1}(S_t) &= R_{t+1} + \gamma R_{t+2} + \cdots + \gamma^{n-1}R_{t+n} + \gamma^nV_{t+n-1}(S_{t+n}) - V_{t+n-1}(S_t) \end{align*}" />

가치의 추정값이 단계가 바뀔 때에 변하지 않으므로, ![equation](https://latex.codecogs.com/svg.latex?n) 단계 오차는 다음과 같이 TD 오차의 합으로 표현된다.

<img src="https://latex.codecogs.com/svg.latex?\inline&space;\begin{align*}&space;G_{t:t&plus;n}&space;-&space;V_{t&plus;n-1}(S_t)&space;&=&space;R_{t&plus;1}&space;&plus;&space;\gamma&space;R_{t&plus;2}&space;&plus;&space;\cdots&space;&plus;&space;\gamma^{n-1}R_{t&plus;n}&space;&plus;&space;\gamma^nV(S_{t&plus;n})&space;-&space;V(S_t)&space;\\&space;&=&space;\delta_t&space;-&space;[\gamma&space;V(S_{t&plus;1})&space;-&space;V(S_t)]&space;&plus;&space;\gamma\delta_{t&plus;1}&space;-&space;\gamma[\gamma&space;V(S_{t&plus;2})&space;-&space;V(S_{t&plus;1})]&space;&plus;&space;\cdots&space;\\&space;&\&space;\&space;\&space;&plus;&space;\gamma^{n-1}\delta_{t&plus;n-1}&space;-&space;\gamma^{n-1}&space;[\gamma&space;V(S_{t&plus;n})&space;-&space;V(S_{t&plus;n-1})]&space;&plus;&space;\gamma^nV(S_{t&plus;n})&space;-&space;V(S_t)&space;\\&space;&=&space;\sum_{k=t}^{t&plus;n-1}\gamma^{k-t}\delta_k&space;-&space;\sum_{k=0}^{n-1}\gamma^k[\gamma&space;V(S_{t&plus;k&plus;1})&space;-&space;V(S_{t&plus;k})]&space;&plus;&space;\gamma^nV(S_{t&plus;n})&space;-&space;V(S_t)&space;\\&space;&=&space;\sum_{k=t}^{t&plus;n-1}\gamma^{k-t}\delta_k&space;-&space;[V(S_t)&space;&plus;&space;\sum_{k=0}^{n-1}\gamma^{k&plus;1}V(S_{t&plus;k&plus;1})&space;-&space;\gamma^n&space;V(S_{t&plus;n})]&space;-&space;\sum_{k=0}^{n-1}\gamma^k&space;V(S_{t&plus;k})&space;\\&space;&=&space;\sum_{k=t}^{t&plus;n-1}\gamma^{k-t}\delta_k&space;-&space;\sum_{k=0}^{n-1}\gamma^k&space;V(S_{t&plus;k})&space;-&space;\sum_{k=0}^{n-1}\gamma^k&space;V(S_{t&plus;k})&space;\\&space;&=&space;\sum_{k=t}^{t&plus;n-1}\gamma^{k-t}\delta_k&space;\end{align*}" title="\begin{align*} G_{t:t+n} - V_{t+n-1}(S_t) &= R_{t+1} + \gamma R_{t+2} + \cdots + \gamma^{n-1}R_{t+n} + \gamma^nV(S_{t+n}) - V(S_t) \\ &= \delta_t - [\gamma V(S_{t+1}) - V(S_t)] + \gamma\delta_{t+1} - \gamma[\gamma V(S_{t+2}) - V(S_{t+1})] + \cdots \\ &\ \ \ + \gamma^{n-1}\delta_{t+n-1} - \gamma^{n-1} [\gamma V(S_{t+n}) - V(S_{t+n-1})] + \gamma^nV(S_{t+n}) - V(S_t) \\ &= \sum_{k=t}^{t+n-1}\gamma^{k-t}\delta_k - \sum_{k=0}^{n-1}\gamma^k[\gamma V(S_{t+k+1}) - V(S_{t+k})] + \gamma^nV(S_{t+n}) - V(S_t) \\ &= \sum_{k=t}^{t+n-1}\gamma^{k-t}\delta_k - [V(S_t) + \sum_{k=0}^{n-1}\gamma^{k+1}V(S_{t+k+1}) - \gamma^n V(S_{t+n})] - \sum_{k=0}^{n-1}\gamma^k V(S_{t+k}) \\ &= \sum_{k=t}^{t+n-1}\gamma^{k-t}\delta_k - \sum_{k=0}^{n-1}\gamma^k V(S_{t+k}) - \sum_{k=0}^{n-1}\gamma^k V(S_{t+k}) \\ &= \sum_{k=t}^{t+n-1}\gamma^{k-t}\delta_k \end{align*}" />
